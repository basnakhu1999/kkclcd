<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="script.js"></script>
</head>
<body>
    <h1>File Management</h1>
    <input type="file" id="fileInput">
    <button onclick="handleUpload()">Upload File</button>
    <ul id="fileList"></ul>
    <button onclick="saveSettings()">Save Settings</button>

    <script>
        let fileSettings = [];

        async function loadFiles() {
            const files = await readSaveFile();
            fileSettings = files;
            renderFileList();
        }

        async function handleUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file!');
                return;
            }
            const path = await uploadFile(file);
            if (path) {
                fileSettings.push({ filename: file.name, type: file.type.startsWith('image') ? 'image' : 'video', duration: 5 });
                renderFileList();
            }
        }

        async function handleDelete(filename) {
            const success = await deleteFile(filename);
            if (success) {
                fileSettings = fileSettings.filter(file => file.filename !== filename);
                renderFileList();
            }
        }

        function renderFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            fileSettings.forEach(file => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${file.filename} (${file.type}) - 
                    <input type="number" value="${file.duration}" onchange="updateDuration('${file.filename}', this.value)"> seconds 
                    <button onclick="handleDelete('${file.filename}')">Delete</button>
                `;
                fileList.appendChild(li);
            });
        }

        function updateDuration(filename, duration) {
            const file = fileSettings.find(file => file.filename === filename);
            if (file) file.duration = parseInt(duration, 10);
        }

        async function saveSettings() {
            const success = await writeSaveFile(fileSettings);
            if (success) {
                alert('Settings saved!');
            }
        }

        // Load files on page load
        loadFiles();
    </script>
</body>
</html>
