<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        img, video {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <div id="media-container"></div>

    <script>
        let files = []; // เก็บข้อมูลไฟล์
        let currentIndex = 0; // ลำดับไฟล์ปัจจุบัน

        // โหลดข้อมูลไฟล์จาก API
        function loadFiles() {
            fetch('https://kkclcd-ol9jud19j-basnakhu1999s-projects.vercel.app/lcd/api/getFiles') // เปลี่ยน URL เป็นของ Vercel หลัง deploy
                .then(response => response.json())
                .then(data => {
                    files = data;
                    if (files.length > 0) showFile(0); // เริ่มแสดงไฟล์แรก
                })
                .catch(error => console.error('Error loading files:', error));
        }

        // ฟังก์ชันแสดงไฟล์ทีละไฟล์
        function showFile(index) {
            const container = document.getElementById('media-container');
            container.innerHTML = ''; // ล้างเนื้อหาเก่า
            currentIndex = index;

            const file = files[index];
            const duration = file.duration * 1000; // ระยะเวลาแสดงผล (แปลงเป็น ms)

            let mediaElement;
            if (file.name.endsWith('.mp4')) {
                mediaElement = document.createElement('video');
                mediaElement.src = `uploads/${file.name}`;
                mediaElement.autoplay = true;
                mediaElement.loop = true; // เล่นซ้ำ
            } else {
                mediaElement = document.createElement('img');
                mediaElement.src = `uploads/${file.name}`;
            }
            container.appendChild(mediaElement);

            // แสดงไฟล์ถัดไปเมื่อครบเวลา
            setTimeout(() => {
                const nextIndex = (index + 1) % files.length; // วนกลับไปเริ่มที่ไฟล์แรกถ้าจบ
                showFile(nextIndex);
            }, duration);
        }

        // โหลดไฟล์และเริ่มแสดงผล
        loadFiles();
    </script>
</body>
</html>
